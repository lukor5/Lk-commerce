<template>
  <div class="nav-bar">
    <div class="svg-container">
      <svg
        @click="redirectToHome()"
        version="1.1"
        xmlns="http://www.w3.org/2000/svg"
        width="250px"
        height="90px"
      >
        <path
          fill="#"
          d="M1.5380859375,47.451171875l0-3.857421875q0-4.00390625,0.13427734375-7.94677734375t0.23193359375-7.94677734375q0-0.7568359375-0.048828125-1.6845703125q-0.0244140625-0.2685546875-0.0244140625-0.5126953125q0-0.6103515625,0.09765625-1.1962890625q0.1220703125-0.78125,0.59814453125-1.3427734375t1.57470703125-0.5615234375q0.9033203125,0,1.37939453125,0.1953125t0.67138671875,0.57373046875t0.2197265625,0.9521484375t0.0244140625,1.33056640625q0,4.052734375-0.09765625,8.1298828125q-0.0732421875,2.7099609375-0.0732421875,5.419921875q0,1.3671875,0.0244140625,2.734375q0.048828125,4.052734375,0.37841796875,8.10546875t1.11083984375,8.0078125q2.44140625-0.09765625,4.8828125-0.244140625t4.8828125-0.146484375q0.244140625,0,0.69580078125,0.048828125t0.9033203125,0.1708984375t0.76904296875,0.3173828125t0.3173828125,0.5615234375q0,0.244140625-0.2197265625,0.4150390625t-0.4150390625,0.2685546875l-0.048828125,0q-0.390625,0.1953125-1.55029296875,0.37841796875t-2.63671875,0.28076171875t-3.1005859375,0.1708984375t-3.0517578125,0.1220703125t-2.47802734375,0.0732421875t-1.2939453125,0.0244140625l-0.2197265625,0q-0.5859375,0-1.318359375-0.1953125q-0.87890625-0.244140625-1.0986328125-0.9521484375q-0.439453125-1.806640625-0.69580078125-3.74755859375t-0.390625-3.94287109375t-0.13427734375-4.00390625z M23.697998046875,60.8056640625l0.5126953125-0.6103515625q-0.09765625-4.1015625-0.2197265625-8.1787109375t-0.1220703125-8.10546875q0-5.0048828125,0.59814453125-9.68017578125t1.18408203125-9.58251953125q0.048828125-0.29296875,0.28076171875-0.47607421875t0.57373046875-0.30517578125t0.69580078125-0.1708984375t0.64697265625-0.048828125q0.390625,0,0.9765625,0.146484375t1.171875,0.8544921875q0,0.244140625,0.03662109375,0.42724609375t0.03662109375,0.42724609375q0,1.85546875-0.50048828125,3.9794921875t-0.67138671875,4.0771484375q-0.1953125,2.392578125-0.2685546875,4.736328125t-0.0732421875,4.7607421875l0.048828125,2.1484375q0.48828125-0.6103515625,1.3916015625-1.5625t1.953125-1.84326171875t2.099609375-1.52587890625t1.904296875-0.634765625q1.2939453125,0,1.79443359375,0.732421875t0.50048828125,1.9287109375q0,1.0986328125-0.47607421875,2.294921875t-1.2451171875,2.33154296875t-1.74560546875,2.03857421875t-1.9287109375,1.3427734375q1.2939453125,1.611328125,2.64892578125,3.076171875t2.96630859375,2.7587890625l0,0.5615234375q-0.048828125,0.244140625-0.30517578125,0.3662109375t-0.5615234375,0.1953125t-0.59814453125,0.10986328125t-0.48828125,0.03662109375q-1.1962890625,0-2.30712890625-0.7080078125t-2.0751953125-1.7333984375t-1.81884765625-2.1728515625t-1.5625-2.001953125q0.146484375,2.8076171875,0.32958984375,5.60302734375t0.18310546875,5.60302734375q0,0.341796875-0.30517578125,0.57373046875t-0.7080078125,0.35400390625t-0.81787109375,0.1708984375t-0.68359375,0.048828125q-1.4404296875,0-2.03857421875-0.52490234375t-1.01318359375-1.81884765625z M28.702880859375,49.306640625q0.6103515625,0,1.45263671875-0.52490234375t1.74560546875-1.30615234375t1.6845703125-1.64794921875t1.25732421875-1.64794921875t0.47607421875-1.25732421875t-0.6591796875-0.42724609375q-0.244140625,0-1.0009765625,0.7080078125t-1.6845703125,1.7333984375t-1.85546875,2.2216796875t-1.416015625,2.1484375z M44.46630859375,47.98828125q0-0.48828125,1.33056640625-0.732421875t3.125-0.35400390625t3.72314453125-0.08544921875t3.125,0.0244140625q0.6103515625,0,1.42822265625,0.23193359375t0.81787109375,0.76904296875q0,0.439453125-0.390625,0.64697265625t-0.91552734375,0.30517578125t-1.025390625,0.09765625l-0.64697265625,0q-1.708984375,0-3.21044921875-0.0732421875t-3.11279296875-0.0732421875q-0.48828125,0-0.98876953125,0.048828125t-0.93994140625,0.048828125l-0.69580078125,0t-0.7568359375-0.0732421875t-0.6103515625-0.244140625t-0.25634765625-0.537109375z M64.013916015625,52.2119140625q0-5.2978515625,0.47607421875-10.60791015625t1.98974609375-10.46142578125q0.439453125-1.5380859375,1.1474609375-3.03955078125t1.7333984375-2.67333984375t2.44140625-1.904296875t3.369140625-0.732421875l0.5126953125,0.048828125q2.099609375,0.29296875,3.1005859375,1.69677734375t1.0009765625,3.50341796875q0,0.5615234375-0.13427734375,1.40380859375t-0.42724609375,1.62353515625t-0.79345703125,1.33056640625t-1.25732421875,0.54931640625q-0.341796875-0.048828125-0.62255859375-0.1220703125t-0.52490234375-0.3173828125q0.390625-0.8544921875,0.69580078125-1.7822265625t0.30517578125-2.1240234375q0-0.439453125-0.0732421875-1.123046875t-0.28076171875-1.35498046875t-0.54931640625-1.171875t-0.9521484375-0.50048828125q-1.5380859375,0-2.587890625,1.72119140625t-1.7578125,4.39453125t-1.0498046875,5.908203125t-0.52490234375,6.25t-0.20751953125,5.4443359375t-0.0244140625,3.43017578125q0,1.171875-0.0244140625,2.587890625l0,0.3173828125q0.0244140625,1.2451171875,0.1708984375,2.3681640625q0.1953125,1.26953125,0.7568359375,2.197265625t1.7578125,1.07421875q0.3662109375,0.048828125,0.7080078125,0.048828125q1.416015625,0,2.5634765625-0.8056640625q1.416015625-1.0009765625,2.5146484375-2.60009765625t1.953125-3.515625t1.57470703125-3.62548828125t1.40380859375-2.83203125t1.416015625-1.123046875q0.244140625,0,0.732421875,0.09765625t0.48828125,0.4638671875q0,0.09765625-0.048828125,0.2685546875t-0.1220703125,0.2685546875q-0.6591796875,2.587890625-1.67236328125,5.37109375t-2.587890625,5.06591796875t-3.857421875,3.72314453125t-5.48095703125,1.4404296875q-2.294921875,0-3.72314453125-0.86669921875t-2.197265625-2.3193359375t-1.0498046875-3.28369140625t-0.28076171875-3.7109375z M89.54296875,51.357421875q0-1.3916015625,0.35400390625-2.86865234375t1.123046875-2.6611328125t1.94091796875-1.9287109375t2.83203125-0.74462890625q1.2451171875,0,2.62451171875,0.42724609375t2.52685546875,1.220703125t1.86767578125,1.94091796875t0.72021484375,2.5634765625q0,1.708984375-0.62255859375,3.2470703125t-1.74560546875,2.74658203125t-2.62451171875,1.904296875t-3.25927734375,0.69580078125q-1.4404296875,0-2.5146484375-0.52490234375t-1.79443359375-1.40380859375t-1.07421875-2.0751953125t-0.35400390625-2.5390625z M93.1318359375,51.30859375q0,0.439453125,0.13427734375,1.2939453125t0.40283203125,1.67236328125t0.69580078125,1.416015625t1.03759765625,0.54931640625q1.2939453125-0.146484375,2.13623046875-0.84228515625t1.3671875-1.69677734375t0.732421875-2.1728515625t0.20751953125-2.2216796875q0-1.3427734375-0.52490234375-2.24609375t-1.72119140625-1.46484375q0,0.048828125,0.048828125,0.048828125t0.048828125-0.048828125l-0.6103515625-0.146484375q-0.244140625-0.09765625-0.59814453125-0.2197265625t-0.69580078125-0.537109375q-0.9521484375,0.341796875-1.47705078125,0.87890625t-0.79345703125,1.30615234375t-0.32958984375,1.84326171875t-0.06103515625,2.587890625z M108.10180664062,44.77783203125q-0.06103515625-0.81787109375,0.09765625-1.50146484375t0.634765625-1.11083984375t1.52587890625-0.42724609375q0.244140625,0,0.59814453125,0.06103515625t0.69580078125,0.15869140625t0.57373046875,0.29296875t0.23193359375,0.537109375l0,2.7587890625q0.9521484375-1.0986328125,2.0751953125-1.57470703125t2.5634765625-0.47607421875q1.0986328125,0,2.1728515625,0.50048828125t2.0263671875,1.33056640625t1.64794921875,1.8310546875t1.01318359375,2.001953125q0.1953125-0.9033203125,0.439453125-2.20947265625t0.72021484375-2.50244140625t1.25732421875-2.05078125t2.0751953125-0.8544921875q1.3916015625,0,2.34375,1.0009765625t1.55029296875,2.60009765625t0.9033203125,3.57666015625t0.45166015625,3.90625t0.146484375,3.60107421875l0,2.62451171875q0,0.29296875-0.2197265625,0.47607421875t-0.54931640625,0.28076171875t-0.68359375,0.1220703125t-0.54931640625,0.0244140625q-0.7568359375,0-1.37939453125-0.23193359375t-0.62255859375-1.18408203125l0-2.197265625t-0.048828125-2.84423828125t-0.1708984375-3.0517578125t-0.3173828125-2.77099609375t-0.50048828125-2.001953125t-0.74462890625-0.78125q-0.6103515625,0-0.87890625,0.68359375t-0.45166015625,1.7333984375t-0.28076171875,2.2216796875t-0.2685546875,2.2216796875t-0.54931640625,1.72119140625t-1.03759765625,0.67138671875q-0.7080078125,0-1.2451171875-0.67138671875t-1.06201171875-1.67236328125t-1.0498046875-2.1484375t-1.15966796875-2.1484375q-0.634765625-1.025390625-1.3671875-1.66015625q-0.6591796875-0.6103515625-1.4892578125-0.5859375l-0.1220703125,0q-1.0986328125,0.048828125-1.72119140625,0.79345703125t-0.9521484375,1.81884765625t-0.40283203125,2.30712890625t-0.0732421875,2.16064453125q0,0.87890625,0.146484375,2.05078125q0.09765625,0.78125,0.09765625,1.4892578125q0,0.3662109375-0.0244140625,0.7080078125q-0.0732421875,1.025390625-0.54931640625,1.72119140625t-1.77001953125,0.69580078125q-0.48828125,0-1.220703125-0.09765625t-0.9765625-0.6591796875q-0.5615234375-1.0009765625-0.8544921875-2.52685546875t-0.439453125-3.1494140625t-0.1708984375-3.22265625t-0.0244140625-2.74658203125q0-0.8056640625-0.06103515625-1.62353515625z M138.953125,44.77783203125q-0.06103515625-0.81787109375,0.09765625-1.50146484375t0.634765625-1.11083984375t1.52587890625-0.42724609375q0.244140625,0,0.59814453125,0.06103515625t0.69580078125,0.15869140625t0.57373046875,0.29296875t0.23193359375,0.537109375l0,2.7587890625q0.9521484375-1.0986328125,2.0751953125-1.57470703125t2.5634765625-0.47607421875q1.0986328125,0,2.1728515625,0.50048828125t2.0263671875,1.33056640625t1.64794921875,1.8310546875t1.01318359375,2.001953125q0.1953125-0.9033203125,0.439453125-2.20947265625t0.72021484375-2.50244140625t1.25732421875-2.05078125t2.0751953125-0.8544921875q1.3916015625,0,2.34375,1.0009765625t1.55029296875,2.60009765625t0.9033203125,3.57666015625t0.45166015625,3.90625t0.146484375,3.60107421875l0,2.62451171875q0,0.29296875-0.2197265625,0.47607421875t-0.54931640625,0.28076171875t-0.68359375,0.1220703125t-0.54931640625,0.0244140625q-0.7568359375,0-1.37939453125-0.23193359375t-0.62255859375-1.18408203125l0-2.197265625t-0.048828125-2.84423828125t-0.1708984375-3.0517578125t-0.3173828125-2.77099609375t-0.50048828125-2.001953125t-0.74462890625-0.78125q-0.6103515625,0-0.87890625,0.68359375t-0.45166015625,1.7333984375t-0.28076171875,2.2216796875t-0.2685546875,2.2216796875t-0.54931640625,1.72119140625t-1.03759765625,0.67138671875q-0.7080078125,0-1.2451171875-0.67138671875t-1.06201171875-1.67236328125t-1.0498046875-2.1484375t-1.15966796875-2.1484375q-0.634765625-1.025390625-1.3671875-1.66015625q-0.6591796875-0.6103515625-1.4892578125-0.5859375l-0.1220703125,0q-1.0986328125,0.048828125-1.72119140625,0.79345703125t-0.9521484375,1.81884765625t-0.40283203125,2.30712890625t-0.0732421875,2.16064453125q0,0.87890625,0.146484375,2.05078125q0.09765625,0.78125,0.09765625,1.4892578125q0,0.3662109375-0.0244140625,0.7080078125q-0.0732421875,1.025390625-0.54931640625,1.72119140625t-1.77001953125,0.69580078125q-0.48828125,0-1.220703125-0.09765625t-0.9765625-0.6591796875q-0.5615234375-1.0009765625-0.8544921875-2.52685546875t-0.439453125-3.1494140625t-0.1708984375-3.22265625t-0.0244140625-2.74658203125q0-0.8056640625-0.06103515625-1.62353515625z M169.74340820312,51.89453125q0-1.708984375,0.37841796875-4.0283203125t1.28173828125-4.39453125t2.38037109375-3.52783203125t3.72314453125-1.45263671875q2.099609375,0,3.1494140625,1.20849609375t1.0498046875,3.25927734375q0,1.3427734375-0.50048828125,2.94189453125t-1.42822265625,3.02734375t-2.197265625,2.38037109375t-2.83203125,0.9521484375l-0.634765625-0.048828125q0,0.6591796875,0.1953125,1.77001953125t0.57373046875,2.20947265625t0.9765625,1.9287109375t1.45263671875,0.830078125q1.2451171875,0,2.392578125-1.0009765625t2.1728515625-2.2216796875t1.904296875-2.2216796875t1.611328125-1.0009765625q0.390625,0,0.8056640625,0.1220703125t0.4638671875,0.68359375q0,0.341796875-0.18310546875,0.5615234375t-0.32958984375,0.48828125q-0.7568359375,1.2939453125-1.64794921875,2.4658203125t-2.01416015625,2.1240234375t-2.45361328125,1.50146484375t-2.94189453125,0.54931640625q-2.099609375,0-3.4912109375-0.74462890625t-2.24609375-2.001953125t-1.23291015625-2.9052734375t-0.37841796875-3.45458984375z M174.11352539062,50.0390625l0.68359375,0.6103515625q0.48828125,0.439453125,0.9765625,0.1953125t0.87890625-0.89111328125t0.72021484375-1.59912109375t0.5859375-1.953125t0.37841796875-1.953125t0.1220703125-1.5869140625l0-0.830078125t-0.0732421875-0.87890625t-0.25634765625-0.69580078125t-0.57373046875-0.35400390625q-0.1220703125-0.0244140625-0.2197265625-0.0244140625q-0.830078125,0-1.416015625,1.0498046875q-0.634765625,1.171875-1.025390625,2.84423828125t-0.5615234375,3.43017578125t-0.2197265625,2.63671875z M190.1455078125,44.0576171875q0-1.0009765625,0.35400390625-1.6845703125t1.50146484375-0.68359375q0.439453125,0,1.0986328125,0.13427734375t0.7568359375,0.67138671875q0.244140625,1.4404296875,0.2685546875,3.125t0.1708984375,3.173828125q0.5615234375-1.0986328125,1.4404296875-2.3681640625t2.001953125-2.34375t2.44140625-1.7822265625t2.685546875-0.7080078125q0.09765625,0,0.3662109375,0.0732421875t0.50048828125,0.20751953125t0.28076171875,0.30517578125t-0.2685546875,0.3173828125q-0.09765625,0.29296875-0.4150390625,0.35400390625t-0.5615234375,0.06103515625q-0.146484375,0-0.4638671875-0.1220703125q-1.806640625,0.9521484375-3.076171875,2.587890625t-2.0751953125,3.62548828125t-1.171875,4.19921875t-0.3662109375,4.30908203125q0,1.0498046875-0.47607421875,1.26953125t-1.52587890625,0.2197265625q-0.5615234375,0-1.18408203125-0.1220703125t-0.86669921875-0.78125q-0.439453125-1.3916015625-0.72021484375-3.1982421875t-0.42724609375-3.72314453125t-0.20751953125-3.77197265625t-0.06103515625-3.3447265625z M207.49584960938,50.4052734375q0-1.7578125,0.45166015625-3.52783203125t1.40380859375-3.173828125t2.42919921875-2.28271484375t3.47900390625-0.87890625q0.8544921875,0,1.8798828125,0.20751953125t1.89208984375,0.6591796875t1.46484375,1.171875t0.59814453125,1.77001953125q0,0.6591796875-0.341796875,0.87890625t-0.9033203125,0.2197265625l-0.1708984375-0.244140625t-0.47607421875-0.62255859375t-0.64697265625-0.8056640625t-0.6591796875-0.72021484375q-1.0009765625-1.0009765625-1.8798828125-1.07421875l-0.1953125,0q-0.732421875,0-1.3671875,0.439453125q-0.7080078125,0.537109375-1.25732421875,1.513671875t-0.91552734375,2.0751953125t-0.57373046875,2.2216796875t-0.20751953125,1.85546875q0,1.0009765625,0.23193359375,2.28271484375t0.78125,2.42919921875t1.3916015625,1.9287109375t2.16064453125,0.78125q1.1962890625,0,2.1728515625-0.5859375t1.86767578125-1.30615234375t1.74560546875-1.2939453125t1.7578125-0.57373046875q0.390625,0,0.79345703125,0.09765625t0.40283203125,0.5126953125l0,0.146484375q-0.439453125,1.1474609375-1.4892578125,2.0263671875t-2.35595703125,1.52587890625t-2.7099609375,0.96435546875t-2.50244140625,0.3173828125q-2.05078125,0-3.60107421875-0.67138671875t-2.57568359375-1.84326171875t-1.55029296875-2.81982421875t-0.52490234375-3.60107421875z M228.80126953125,51.89453125q0-1.708984375,0.37841796875-4.0283203125t1.28173828125-4.39453125t2.38037109375-3.52783203125t3.72314453125-1.45263671875q2.099609375,0,3.1494140625,1.20849609375t1.0498046875,3.25927734375q0,1.3427734375-0.50048828125,2.94189453125t-1.42822265625,3.02734375t-2.197265625,2.38037109375t-2.83203125,0.9521484375l-0.634765625-0.048828125q0,0.6591796875,0.1953125,1.77001953125t0.57373046875,2.20947265625t0.9765625,1.9287109375t1.45263671875,0.830078125q1.2451171875,0,2.392578125-1.0009765625t2.1728515625-2.2216796875t1.904296875-2.2216796875t1.611328125-1.0009765625q0.390625,0,0.8056640625,0.1220703125t0.4638671875,0.68359375q0,0.341796875-0.18310546875,0.5615234375t-0.32958984375,0.48828125q-0.7568359375,1.2939453125-1.64794921875,2.4658203125t-2.01416015625,2.1240234375t-2.45361328125,1.50146484375t-2.94189453125,0.54931640625q-2.099609375,0-3.4912109375-0.74462890625t-2.24609375-2.001953125t-1.23291015625-2.9052734375t-0.37841796875-3.45458984375z M233.17138671875,50.0390625l0.68359375,0.6103515625q0.48828125,0.439453125,0.9765625,0.1953125t0.87890625-0.89111328125t0.72021484375-1.59912109375t0.5859375-1.953125t0.37841796875-1.953125t0.1220703125-1.5869140625l0-0.830078125t-0.0732421875-0.87890625t-0.25634765625-0.69580078125t-0.57373046875-0.35400390625q-0.1220703125-0.0244140625-0.2197265625-0.0244140625q-0.830078125,0-1.416015625,1.0498046875q-0.634765625,1.171875-1.025390625,2.84423828125t-0.5615234375,3.43017578125t-0.2197265625,2.63671875z"
        />
        <path fill="#" d="" />
      </svg>
    </div>
    <div class="nav-wrapper">
      <div class="search-dropdown-wrapper">
        <div class="search-bar">
          <SearchBar
            @dropdown-toggled="handleDropdownToggled"
            @product-clicked="this.showSearchResults = false"
            :closeDropdown="this.showSearchResults"
          />
          <CategoryDropdown
            @dropdown-toggled="handleDropdownToggled"
            @category-clicked="this.showDropdown = false"
            :closeDropdown="this.showDropdown"
          />
        </div>
      </div>
      <div class="buttons-userdropdown-wrapper">
        <div class="buttons">
          <div @click="toggleBasket()" class="icon-button">
            <button>
              <font-awesome-icon
                :icon="['fas', 'basket-shopping']"
                class="icon-big"
              />
            </button>
            <span v-if="basketQuantity > 0" class="basket-quantity">{{
              basketQuantity
            }}</span>
          </div>
          <button @click="toggleUserDropdown()" class="icon-button">
            <font-awesome-icon :icon="['far', 'user']" class="icon-big" />
          </button>
          <div
            class="user-dropdown"
            :class="{ 'show-dropdown': showUserDropdown }"
          >
            <b v-if="isLoggedIn">{{ userName }}</b>
            <button @click="handleOptionClicked('Settings')" v-if="isLoggedIn">
              <span>Settings</span>
              <font-awesome-icon :icon="['fas', 'gear']" />
            </button>
            <button @click="handleOptionClicked('Vouchers')" v-if="isLoggedIn">
              <span>Vouchers</span>
              <font-awesome-icon :icon="['fas', 'percent']" />
            </button>
            <button @click="handleOptionClicked('Orders')" v-if="isLoggedIn">
              <span>Orders</span>
              <font-awesome-icon :icon="['fas', 'scroll']" />
            </button>
            <button
              @click="
                emitLoginPopup();
                toggleUserDropdown();
              "
              v-if="!isLoggedIn"
            >
              Login
            </button>
            <button
              @click="
                redirectToRegister();
                toggleUserDropdown();
              "
              v-if="!isLoggedIn"
            >
              Register
            </button>
            <button
              @click="
                logoutUser();
                toggleUserDropdown();
              "
              v-if="isLoggedIn"
            >
              Logout
            </button>
          </div>
          <div class="dark-mode-container">
            <font-awesome-icon :icon="['far', 'sun']" />
            <button
              @click="toggleDarkMode()"
              :class="{ 'dark-mode-button': isDarkMode }"
            >
              <button class="thumb"></button>
            </button>
            <font-awesome-icon :icon="['far', 'moon']" />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import axios from "axios";
import { mapGetters, mapActions } from "vuex";
import SearchBar from "../components/SearchBar.vue";
import CategoryDropdown from "../components/CategoryDropdown.vue";
import Cookies from "js-cookie";
export default {
  name: "NavBar",
  props: {},
  components: {
    SearchBar,
    CategoryDropdown,
  },
  data() {
    return {
      showSearchResults: false,
      showUserDropdown: false,
      showLoginPopup: false,
      showBasket: false,
      showDropdown: false,
      categories: [],
      common_types: [],
      winter_types: [],
      input: "",
      productList: [],
      baseUrl: this.$baseUrl,
      isDarkMode: false,
    };
  },
  computed: {
    ...mapGetters(["user", "basket"]),
    isLoggedIn() {
      return this.user.id !== null;
    },
    userName() {
      return this.user.username;
    },
    basketQuantity() {
      return this.basket.quantity;
    },
  },
  methods: {
    ...mapActions(["updateUser", "updateBasket"]),

    closeDropdowns(event) {
      const isCategories =
        event.target.closest(".category-dropdown") !== null ||
        event.target.closest(".category-button") !== null;
      const isSearchResults =
        event.target.closest(".dropdown-products") !== null;
      const isUserButtons =
        event.target.closest(".icon-button") !== null ||
        event.target.closest("user-dropdown") !== null;
      if (!isCategories) {
        this.showDropdown = false;
      }
      if (!isSearchResults) {
        this.showSearchResults = false;
      }
      if (!isUserButtons) {
        this.showUserDropdown = false;
      }
    },
    handleDropdownToggled(dropdown, type) {
      switch (type) {
        case "category":
          this.showDropdown = dropdown;
          break;
        case "search":
          this.showSearchResults = dropdown;
          break;
        default:
          break;
      }
    },
    toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
      this.isDarkMode = !this.isDarkMode;
      Cookies.set("isDarkMode", this.isDarkMode);
    },
    closeDropdown() {
      this.showDropdown = false;
    },
    toggleUserDropdown() {
      this.showUserDropdown = !this.showUserDropdown;
    },
    closeUserDropdown() {
      this.showUserDropdown = !this.showUserDropdown;
    },

    handleProductClick(product) {
      this.input = "";
      this.$emit("product-clicked", product);
    },
    handleOptionClicked(option) {
      this.$emit("option-clicked", option);
    },

    emitLoginPopup() {
      this.showLoginPopup = !this.showLoginPopup;
      this.$emit("login-clicked", this.showLoginPopup);
    },

    toggleBasket() {
      this.showBasket = !this.showBasket;
      this.$emit("basket-clicked", this.showBasket);
    },
    redirectToRegister() {
      this.$router.push({
        name: "registerForm",
      });
    },
    redirectToHome() {
      this.$router.push("/");
    },

    logoutUser() {
      this.updateUser({ id: null, username: null });
      this.updateBasket({
        basketItems: null,
        quantity: null,
        totalPrice: null,
      });
      this.$router.push("/");
      this.$emit("result", "Logged out");
    },

    getProducts() {
      axios
        .get(this.baseUrl + "/products")
        .then((response) => {
          this.productList = response.data;
        })
        .catch((error) => {
          console.error("Error fetching products", error);
        });
    },
    getDarkModeCookie() {
      const isCookieDarkMode = Cookies.get("isDarkMode") === "true";
      if (isCookieDarkMode) {
        this.isDarkMode = isCookieDarkMode;
      }
    },
  },
  mounted() {
    document.body.addEventListener("click", this.closeDropdowns);
    this.getProducts();
    this.getDarkModeCookie();
  },

  created() {},
  watch: {},
};
</script>

<style scoped lang="scss">
@import "../assets/styles/main.scss";

.svg-container {
  svg {
    fill: var(--text-color);
  }
}

.svg-container:hover {
  cursor: pointer;
  padding: 0px;
}

.nav-bar {
  display: flex;
  align-items: center;
  justify-content: space-around;
  flex-wrap: wrap;

  .search-bar {
    display: flex;
    align-items: stretch;
  }

  .search-dropdown-wrapper {
    position: relative;
    display: flex;
    flex-direction: column;
  }

  .nav-wrapper {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .buttons {
    position: relative;
    display: flex;
    flex-direction: row;
    .dark-mode-container {
      display: flex;
      flex-direction: row;
      align-items: center;
      margin-left: 20px;
      gap: 5px;
      button {
        display: flex;
        align-items: center;
        padding: 2px;
        width: 40px;

        border: 1px solid var(--border-color);
        border-radius: 10px;
        .thumb {
          width: 15px;
          height: 15px;
          border: 1px solid var(--border-color);
          background-color: var(--border-color);
          transform: translateX(0);
          transition: all 300ms;
        }
      }
      .dark-mode-button {
        .thumb {
          transform: translateX(20px);
        }
      }
    }
  }
  .basket-quantity {
    position: absolute;
    bottom: -10px;
    left: 25px;
    border-radius: 20px;
    background-color: var(--secondary-color);
    color: white;
    width: 20px;
    padding: 1px;
    font-weight: bold;
  }

  .basket-quantity:hover {
    cursor: pointer;
  }

  .user-dropdown {
    position: absolute;
    display: none;
    background-color: var(--background-color);
    z-index: 3;
    padding: 10px;
    flex-direction: column;
    gap: 10px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    box-shadow: 2px 2px 2px 2px
      rgba(var(--shadow-color-rgb), var(--shadow-opacity));
    top: 45px;

    button {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: space-between;
      background-color: var(--background-color);
      border-bottom: 1px solid var(--secondary-color);
      padding: 5px;
    }
    button:hover {
      @include secondary-button;
      cursor: pointer;
      border-radius: 5px;
    }
  }

  .show-dropdown {
    display: flex;
    justify-content: center;
  }
}

@media (max-height: 800px) {
  .svg-container {
    display: none;
  svg {
    fill: var(--text-color);
  }
}
}
</style>